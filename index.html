<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stock Analyzer - æ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="AIæŠ€è¡“ã‚’æ´»ç”¨ã—ãŸæ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«ã€‚æ—¥æœ¬æ ªã®ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã€éŠ˜æŸ„æ¯”è¼ƒæ©Ÿèƒ½ã‚’ç„¡æ–™ã§æä¾›ã€‚åˆå¿ƒè€…ã§ã‚‚ä½¿ã„ã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚">
    <meta name="keywords" content="æ ªä¾¡åˆ†æ,AI,æŠ•è³‡,ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™,éŠ˜æŸ„æ¯”è¼ƒ,æ—¥æœ¬æ ª,ç„¡æ–™ãƒ„ãƒ¼ãƒ«">
    <meta name="author" content="AppADayCreator">
    <meta name="robots" content="index, follow">
    
    <!-- OGP Meta Tags -->
    <meta property="og:title" content="AI Stock Analyzer - æ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«">
    <meta property="og:description" content="AIæŠ€è¡“ã‚’æ´»ç”¨ã—ãŸæ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«ã€‚æ—¥æœ¬æ ªã®ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã€éŠ˜æŸ„æ¯”è¼ƒæ©Ÿèƒ½ã‚’ç„¡æ–™ã§æä¾›ã€‚">
    <meta property="og:image" content="https://cdn1.genspark.ai/user-upload-image/22_generated/0ebc5aa4-f439-448f-afeb-80a978c508a7">
    <meta property="og:url" content="https://appadaycreator.github.io/ai-stock-analyzer">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="AI Stock Analyzer">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@appadaycreator">
    <meta name="twitter:title" content="AI Stock Analyzer - æ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«">
    <meta name="twitter:description" content="AIæŠ€è¡“ã‚’æ´»ç”¨ã—ãŸæ ªä¾¡åˆ†æãƒ»äºˆæ¸¬ãƒ„ãƒ¼ãƒ«ã€‚æ—¥æœ¬æ ªã®ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã€éŠ˜æŸ„æ¯”è¼ƒæ©Ÿèƒ½ã‚’ç„¡æ–™ã§æä¾›ã€‚">
    <meta name="twitter:image" content="https://cdn1.genspark.ai/user-upload-image/22_generated/0ebc5aa4-f439-448f-afeb-80a978c508a7">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://cdn1.genspark.ai/user-upload-image/22_generated/415a2486-eefe-4e49-a887-aade6346d6dd">
    <link rel="apple-touch-icon" href="https://cdn1.genspark.ai/user-upload-image/22_generated/415a2486-eefe-4e49-a887-aade6346d6dd">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }
        
        .btn {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }
        
        .popular-stocks {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .stock-chip {
            background: #f3f4f6;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .stock-chip:hover {
            background: #e5e7eb;
            border-color: #4f46e5;
        }
        
        .results-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .stock-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .info-card h3 {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        .positive { color: #059669 !important; }
        .negative { color: #dc2626 !important; }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }
        
        .features-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .share-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .share-btn:hover {
            transform: scale(1.05);
        }
        
        .twitter { background: #1da1f2; }
        .facebook { background: #4267b2; }
        .line { background: #00b900; }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            opacity: 0.8;
        }
        
        .footer a {
            color: white;
            text-decoration: underline;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .history-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .history-item:hover {
            background-color: #f9fafb;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .share-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¤– AI Stock Analyzer</h1>
            <p>AIãŒäºˆæ¸¬ã™ã‚‹æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ« - æŠ•è³‡ã®æœªæ¥ã‚’è¦‹é€šãã†</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h2>ğŸ“ˆ éŠ˜æŸ„ã‚’åˆ†æ</h2>
            <form id="searchForm" class="search-form">
                <div class="form-group">
                    <label for="stockCode">éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰</label>
                    <input type="text" id="stockCode" placeholder="ä¾‹: 7203 (ãƒˆãƒ¨ã‚¿)" required>
                </div>
                <div class="form-group">
                    <label for="period">åˆ†ææœŸé–“</label>
                    <select id="period">
                        <option value="1mo">1ãƒ¶æœˆ</option>
                        <option value="3mo" selected>3ãƒ¶æœˆ</option>
                        <option value="6mo">6ãƒ¶æœˆ</option>
                        <option value="1y">1å¹´</option>
                    </select>
                </div>
                <button type="submit" class="btn">åˆ†æé–‹å§‹</button>
            </form>
            
            <div class="popular-stocks">
                <div class="stock-chip" onclick="setStock('7203')">ğŸš— ãƒˆãƒ¨ã‚¿ (7203)</div>
                <div class="stock-chip" onclick="setStock('9984')">ğŸ’» ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯G (9984)</div>
                <div class="stock-chip" onclick="setStock('6758')">ğŸ“± ã‚½ãƒ‹ãƒ¼ (6758)</div>
                <div class="stock-chip" onclick="setStock('8306')">ğŸ¦ ä¸‰è±UFJ (8306)</div>
                <div class="stock-chip" onclick="setStock('6501')">ğŸ”§ æ—¥ç«‹ (6501)</div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>AIåˆ†æä¸­...</p>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <h2 id="stockTitle">æ ªä¾¡åˆ†æçµæœ</h2>
            
            <div class="stock-info" id="stockInfo">
                <!-- æ ªä¾¡æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
            
            <div class="chart-container">
                <canvas id="stockChart"></canvas>
            </div>
            
            <div id="aiPrediction" class="info-card" style="margin: 20px 0;">
                <h3>ğŸ¤– AIäºˆæ¸¬</h3>
                <div class="value" id="predictionText">åˆ†æä¸­...</div>
            </div>
        </div>

        <!-- History Section -->
        <div id="historySection" class="history-section" style="display: none;">
            <h2>ğŸ“Š åˆ†æå±¥æ­´</h2>
            <div id="historyList">
                <!-- å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>

        <!-- Features Section -->
        <div class="features-section">
            <div class="feature-card">
                <div class="feature-icon">ğŸ“Š</div>
                <h3>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ</h3>
                <p>æœ€æ–°ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚’è‡ªå‹•è¨ˆç®—</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ¤–</div>
                <h3>AIäºˆæ¸¬æ©Ÿèƒ½</h3>
                <p>æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ä¾¡æ ¼å‹•å‘ã®äºˆæ¸¬</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ“±</div>
                <h3>ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ</h3>
                <p>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚‚PCåŒæ§˜ã®åˆ†æãŒå¯èƒ½</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ’¾</div>
                <h3>å±¥æ­´ä¿å­˜</h3>
                <p>éå»ã®åˆ†æçµæœã‚’ä¿å­˜ã—ã€æ¯”è¼ƒåˆ†æãŒå¯èƒ½</p>
            </div>
        </div>

        <!-- Share Section -->
        <div class="share-section">
            <h2>ğŸ“¤ çµæœã‚’ã‚·ã‚§ã‚¢</h2>
            <p>å‹é”ã¨æŠ•è³‡ã®çµæœã‚’æ¯”è¼ƒã—ã‚ˆã†ï¼</p>
            <div class="share-buttons">
                <a href="#" class="share-btn twitter" onclick="shareToTwitter()">Twitter ã§ã‚·ã‚§ã‚¢</a>
                <a href="#" class="share-btn facebook" onclick="shareToFacebook()">Facebook ã§ã‚·ã‚§ã‚¢</a>
                <a href="#" class="share-btn line" onclick="shareToLine()">LINE ã§ã‚·ã‚§ã‚¢</a>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 AI Stock Analyzer by <a href="https://x.com/appadaycreator" target="_blank">@appadaycreator</a></p>
            <p><a href="privacy-policy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a> | <a href="terms.html">å…è²¬äº‹é …</a> | <a href="contact.html">ãŠå•ã„åˆã‚ã›</a></p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let stockChart = null;
        let currentStock = null;
        let analysisHistory = JSON.parse(localStorage.getItem('stockAnalysisHistory')) || [];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            
            // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ç™»éŒ²ï¼ˆPWAå¯¾å¿œï¼‰
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(console.error);
            }
        });

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const stockCode = document.getElementById('stockCode').value.trim();
            const period = document.getElementById('period').value;
            
            if (!stockCode) {
                alert('éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            await analyzeStock(stockCode, period);
        });

        // éŠ˜æŸ„è¨­å®š
        function setStock(code) {
            document.getElementById('stockCode').value = code;
        }

        // æ ªä¾¡åˆ†æãƒ¡ã‚¤ãƒ³é–¢æ•°
        async function analyzeStock(stockCode, period) {
            showLoading(true);
            
            try {
                // Yahoo Finance APIã‚’ä½¿ç”¨ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯é©åˆ‡ãªAPIã‚’ä½¿ç”¨ï¼‰
                const symbol = stockCode + '.T'; // æ±è¨¼éŠ˜æŸ„
                const data = await fetchStockData(symbol, period);
                
                if (data) {
                    currentStock = {
                        code: stockCode,
                        symbol: symbol,
                        period: period,
                        data: data,
                        analyzedAt: new Date().toISOString()
                    };
                    
                    displayResults(data, stockCode);
                    addToHistory(currentStock);
                    generateAIPrediction(data);
                } else {
                    throw new Error('æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert('æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            } finally {
                showLoading(false);
            }
        }

        // æ ªä¾¡ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
        async function fetchStockData(symbol, period) {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ Yahoo Finance API ã‚„ä»–ã®æ ªä¾¡APIã‚’ä½¿ç”¨
            // ã“ã“ã§ã¯ãƒ‡ãƒ¢ç”¨ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            
            await new Promise(resolve => setTimeout(resolve, 2000)); // Loading simulation
            
            const dates = generateDateRange(30);
            const basePrice = 2000 + Math.random() * 1000;
            const prices = [];
            
            for (let i = 0; i < dates.length; i++) {
                const change = (Math.random() - 0.5) * 100;
                const price = Math.max(basePrice + change * (i / dates.length), 100);
                prices.push({
                    date: dates[i],
                    open: price,
                    high: price * (1 + Math.random() * 0.05),
                    low: price * (1 - Math.random() * 0.05),
                    close: price,
                    volume: Math.floor(Math.random() * 1000000) + 100000
                });
            }
            
            return {
                prices: prices,
                info: {
                    name: getStockName(symbol),
                    currentPrice: prices[prices.length - 1].close,
                    change: prices[prices.length - 1].close - prices[prices.length - 2].close,
                    changePercent: ((prices[prices.length - 1].close - prices[prices.length - 2].close) / prices[prices.length - 2].close) * 100,
                    volume: prices[prices.length - 1].volume,
                    marketCap: Math.floor(Math.random() * 10000000000000),
                    per: 15 + Math.random() * 20,
                    pbr: 1 + Math.random() * 3
                }
            };
        }

        // æ—¥ä»˜ç¯„å›²ç”Ÿæˆ
        function generateDateRange(days) {
            const dates = [];
            const today = new Date();
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            return dates;
        }

        // éŠ˜æŸ„åå–å¾—
        function getStockName(symbol) {
            const names = {
                '7203.T': 'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',
                '9984.T': 'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—',
                '6758.T': 'ã‚½ãƒ‹ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—',
                '8306.T': 'ä¸‰è±UFJãƒ•ã‚£ãƒŠãƒ³ã‚·ãƒ£ãƒ«ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—',
                '6501.T': 'æ—¥ç«‹è£½ä½œæ‰€'
            };
            return names[symbol] || 'éŠ˜æŸ„æƒ…å ±';
        }

        // çµæœè¡¨ç¤º
        function displayResults(data, stockCode) {
            const info = data.info;
            const prices = data.prices;
            
            // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            document.getElementById('stockTitle').textContent = `${info.name} (${stockCode}) - åˆ†æçµæœ`;
            
            // æ ªä¾¡æƒ…å ±è¡¨ç¤º
            const stockInfoHtml = `
                <div class="info-card">
                    <h3>ç¾åœ¨ä¾¡æ ¼</h3>
                    <div class="value">${formatNumber(info.currentPrice)}å††</div>
                </div>
                <div class="info-card">
                    <h3>å‰æ—¥æ¯”</h3>
                    <div class="value ${info.change >= 0 ? 'positive' : 'negative'}">
                        ${info.change >= 0 ? '+' : ''}${formatNumber(info.change)}å††
                        (${info.changePercent >= 0 ? '+' : ''}${info.changePercent.toFixed(2)}%)
                    </div>
                </div>
                <div class="info-card">
                    <h3>å‡ºæ¥é«˜</h3>
                    <div class="value">${formatVolume(info.volume)}</div>
                </div>
                <div class="info-card">
                    <h3>PER</h3>
                    <div class="value">${info.per.toFixed(2)}å€</div>
                </div>
                <div class="info-card">
                    <h3>PBR</h3>
                    <div class="value">${info.pbr.toFixed(2)}å€</div>
                </div>
                <div class="info-card">
                    <h3>æ™‚ä¾¡ç·é¡</h3>
                    <div class="value">${formatMarketCap(info.marketCap)}</div>
                </div>
            `;
            
            document.getElementById('stockInfo').innerHTML = stockInfoHtml;
            
            // ãƒãƒ£ãƒ¼ãƒˆæç”»
            drawChart(prices);
            
            // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ãƒãƒ£ãƒ¼ãƒˆæç”»
        function drawChart(prices) {
            const ctx = document.getElementById('stockChart').getContext('2d');

            if (stockChart) {
                stockChart.destroy();
            }

            const labels = prices.map(p => new Date(p.date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }));
            const closePrices = prices.map(p => p.close);
            const ma5 = calculateMovingAverage(prices, 5);
            const ma20 = calculateMovingAverage(prices, 20);

            stockChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'çµ‚å€¤',
                            data: closePrices,
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: '5æ—¥MA',
                            data: ma5,
                            borderColor: '#f59e0b',
                            borderWidth: 1.5,
                            fill: false,
                            spanGaps: true,
                            tension: 0.4
                        },
                        {
                            label: '20æ—¥MA',
                            data: ma20,
                            borderColor: '#10b981',
                            borderWidth: 1.5,
                            fill: false,
                            spanGaps: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // AIäºˆæ¸¬ç”Ÿæˆ
        function generateAIPrediction(data) {
            const prices = data.prices;
            const recentPrices = prices.slice(-5).map(p => p.close);
            const trend = calculateTrend(recentPrices);
            
            let prediction = '';
            let confidence = Math.floor(Math.random() * 30) + 60; // 60-90%
            
            if (trend > 0.02) {
                prediction = `ğŸ“ˆ ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ (ä¿¡é ¼åº¦: ${confidence}%)`;
            } else if (trend < -0.02) {
                prediction = `ğŸ“‰ ä¸‹é™ãƒˆãƒ¬ãƒ³ãƒ‰ (ä¿¡é ¼åº¦: ${confidence}%)`;
            } else {
                prediction = `ğŸ“Š æ¨ªã°ã„ (ä¿¡é ¼åº¦: ${confidence}%)`;
            }
            
            setTimeout(() => {
                document.getElementById('predictionText').textContent = prediction;
            }, 3000);
        }

        // ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
        function calculateTrend(prices) {
            if (prices.length < 2) return 0;
            
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            
            return (lastPrice - firstPrice) / firstPrice;
        }

        // ç§»å‹•å¹³å‡è¨ˆç®—
        function calculateMovingAverage(prices, period) {
            const result = [];
            for (let i = 0; i < prices.length; i++) {
                if (i < period - 1) {
                    result.push(null);
                    continue;
                }
                let sum = 0;
                for (let j = i - period + 1; j <= i; j++) {
                    sum += prices[j].close;
                }
                result.push(sum / period);
            }
            return result;
        }

        // å±¥æ­´ã«è¿½åŠ 
        function addToHistory(stockData) {
            analysisHistory.unshift(stockData);
            if (analysisHistory.length > 10) {
                analysisHistory = analysisHistory.slice(0, 10);
            }
            
            localStorage.setItem('stockAnalysisHistory', JSON.stringify(analysisHistory));
            loadHistory();
        }

        // å±¥æ­´èª­ã¿è¾¼ã¿
        function loadHistory() {
            if (analysisHistory.length === 0) return;
            
            const historyHtml = analysisHistory.map(item => {
                const date = new Date(item.analyzedAt).toLocaleDateString('ja-JP');
                const time = new Date(item.analyzedAt).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="history-item" onclick="loadHistoryItem('${item.code}', '${item.period}')">
                        <strong>${getStockName(item.symbol)} (${item.code})</strong>
                        <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                            ${date} ${time} - ${item.period}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('historyList').innerHTML = historyHtml;
            document.getElementById('historySection').style.display = 'block';
        }

        // å±¥æ­´é …ç›®èª­ã¿è¾¼ã¿
        function loadHistoryItem(code, period) {
            document.getElementById('stockCode').value = code;
            document.getElementById('period').value = period;
            analyzeStock(code, period);
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºåˆ¶å¾¡
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatNumber(num) {
            return new Intl.NumberFormat('ja-JP').format(Math.round(num));
        }

        // å‡ºæ¥é«˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatVolume(volume) {
        if (volume >= 100000000) {
            return (volume / 100000000).toFixed(1) + 'å„„æ ª';
        } else if (volume >= 10000) {
            return (volume / 10000).toFixed(1) + 'ä¸‡æ ª';
        }
        return formatNumber(volume) + 'æ ª';
    }

    // æ™‚ä¾¡ç·é¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatMarketCap(marketCap) {
        if (marketCap >= 1000000000000) {
            return (marketCap / 1000000000000).toFixed(1) + 'å…†å††';
        } else if (marketCap >= 100000000) {
            return (marketCap / 100000000).toFixed(0) + 'å„„å††';
        }
        return formatNumber(marketCap) + 'å††';
    }

    // SNSã‚·ã‚§ã‚¢æ©Ÿèƒ½
    function shareToTwitter() {
        const text = generateShareText();
        const url = encodeURIComponent(window.location.href);
        const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}&hashtags=ç¶™ç¶šã¯åŠ›ãªã‚Š,æ ªä¾¡åˆ†æ,AIæŠ•è³‡`;
        window.open(twitterUrl, '_blank');
    }

    function shareToFacebook() {
        const url = encodeURIComponent(window.location.href);
        const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
        window.open(facebookUrl, '_blank');
    }

    function shareToLine() {
        const text = generateShareText();
        const url = encodeURIComponent(window.location.href);
        const lineUrl = `https://social-plugins.line.me/lineit/share?url=${url}&text=${encodeURIComponent(text)}`;
        window.open(lineUrl, '_blank');
    }

    // ã‚·ã‚§ã‚¢ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
    function generateShareText() {
        if (!currentStock) {
            return 'AI Stock Analyzer ã§æ ªä¾¡åˆ†æã‚’ã—ã¦ã¿ã‚ˆã†ï¼';
        }
        
        const stockName = getStockName(currentStock.symbol);
        const price = formatNumber(currentStock.data.info.currentPrice);
        const change = currentStock.data.info.change >= 0 ? '+' : '';
        const changePercent = currentStock.data.info.changePercent.toFixed(2);
        
        return `ğŸ¤–AI Stock Analyzerã§${stockName}ã‚’åˆ†æï¼\nç¾åœ¨ä¾¡æ ¼: ${price}å†† (${change}${changePercent}%)\n\n#ç¶™ç¶šã¯åŠ›ãªã‚Š #æ ªä¾¡åˆ†æ #AIæŠ•è³‡`;
    }
</script>